<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenProject Assistant</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>OpenProject Assistant</h1>
      <div class="header-actions">
        <button id="settingsBtn" class="icon-btn" title="Settings">‚öôÔ∏è</button>
        <button id="refreshBtn" class="icon-btn" title="Refresh">üîÑ</button>
      </div>
    </header>

    <nav class="tabs">
      <button class="tab-btn active" data-tab="worklog">Worklog</button>
      <button class="tab-btn" data-tab="timer">Timer</button>
      <button class="tab-btn" data-tab="reports">Reports</button>
      <button class="tab-btn" data-tab="tasks">Tasks</button>
    </nav>

    <!-- Worklog Tab -->
    <div id="worklog" class="tab-content active">
      <div class="section">
        <h2>Log Work</h2>
        <div id="connectionStatusWorklog" class="status-indicator" style="display: none;"></div>

        <div class="form-group">
          <label>Work Package Mode</label>
          <div class="mode-toggle">
            <button type="button" id="existingModeBtn" class="mode-btn active">Select Existing</button>
            <button type="button" id="newModBtn" class="mode-btn">Create New</button>
          </div>
        </div>

        <!-- Existing Work Package Selection -->
        <div id="existingWorkPackageSection" class="form-group">
          <label for="workPackageSelect">Work Package</label>
          <div class="searchable-select-wrapper">
            <input type="text" id="workPackageSearchInput" class="searchable-select-search" placeholder="Type to search work packages..." />
            <select id="workPackageSelect" size="6">
              <option value="">Loading work packages...</option>
            </select>
          </div>
        </div>

        <!-- New Work Package Creation -->
        <div id="newWorkPackageSection" class="form-group" style="display: none;">
          <div class="form-group">
            <label for="projectSelect">Project *</label>
            <div class="searchable-select-wrapper">
              <input type="text" id="projectSearchInput" class="searchable-select-search" placeholder="Type to search projects..." />
              <select id="projectSelect" size="3"></select>
            </div>
          </div>

          <div class="form-group">
            <label for="taskTitle">Task Title *</label>
            <input type="text" id="taskTitle" placeholder="Enter task title..." />
          </div>

          <div class="form-group">
            <label for="taskType">Task Type</label>
            <select id="taskType">
              <option value="1">Task</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="workDate">Date</label>
          <input type="date" id="workDate" />
        </div>

        <div class="time-input-group">
          <div class="form-group half-width">
            <label for="workStartTime">Start Time (Optional)</label>
            <input type="time" id="workStartTime" />
          </div>

          <div class="form-group half-width">
            <label for="workEndTime">End Time (Optional)</label>
            <input type="time" id="workEndTime" />
          </div>
        </div>

        <div class="form-group">
          <label for="workHours">Hours</label>
          <input type="number" id="workHours" min="0" max="24" step="0.25" placeholder="Hours spent (or use time range above)" />
        </div>

        <div class="form-group">
          <label for="workComment">Comment</label>
          <textarea id="workComment" rows="3" placeholder="Describe the work done..."></textarea>
        </div>

        <button id="logWorkBtn" class="btn btn-primary">Log Work</button>
        <button id="resetWorklogBtn" class="btn btn-secondary">Reset</button>
      </div>

      <div class="section">
        <h2>Recent Worklogs</h2>
        <div id="recentWorklogsContainer">
          <p class="loading">Loading recent worklogs...</p>
        </div>
      </div>
    </div>

    <!-- Timer Tab -->
    <div id="timer" class="tab-content">
      <div class="section">
        <h2>Time Tracker</h2>
        <div id="connectionStatusTimer" class="status-indicator" style="display: none;"></div>

        <div class="timer-display">
          <div id="timerTime" class="timer-time">00:00:00</div>
        </div>

        <div class="form-group">
          <label for="timerWorkPackage">Work Package</label>
          <div class="searchable-select-wrapper">
            <input type="text" id="timerWorkPackageSearch" class="searchable-select-search" placeholder="Type to search work packages..." />
            <select id="timerWorkPackage" size="6">
              <option value="">Select work package...</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="timerComment">What are you working on?</label>
          <textarea id="timerComment" rows="2" placeholder="Task description..."></textarea>
        </div>

        <div class="timer-controls">
          <button id="startTimerBtn" class="btn btn-success">Start</button>
          <button id="pauseTimerBtn" class="btn btn-warning" disabled>Pause</button>
          <button id="stopTimerBtn" class="btn btn-danger" disabled>Stop & Log</button>
          <button id="resetTimerBtn" class="btn btn-secondary">Reset</button>
        </div>
      </div>
    </div>

    <!-- Reports Tab -->
    <div id="reports" class="tab-content">
      <div class="section">
        <h2>Generate Reports</h2>

        <div class="form-group">
          <label for="reportType">Report Type</label>
          <select id="reportType">
            <option value="worklog">Worklog Report</option>
            <option value="user">User Summary</option>
            <option value="project">Project Summary</option>
            <option value="weekly">Weekly Report</option>
          </select>
        </div>

        <div class="form-group">
          <label for="reportStartDate">Start Date</label>
          <input type="date" id="reportStartDate" />
        </div>

        <div class="form-group">
          <label for="reportEndDate">End Date</label>
          <input type="date" id="reportEndDate" />
        </div>

        <button id="generateReportBtn" class="btn btn-primary">Generate Report</button>
        <button id="exportReportBtn" class="btn btn-secondary" disabled>Export CSV</button>
      </div>

      <div id="reportResults" class="section" style="display: none;">
        <h2>Report Results</h2>
        <div id="reportContent"></div>
      </div>
    </div>

    <!-- Tasks Tab -->
    <div id="tasks" class="tab-content">
      <div class="section">
        <h2>My Work Packages</h2>

        <div class="filters">
          <select id="taskStatusFilter">
            <option value="">All Statuses</option>
            <option value="new">New</option>
            <option value="in-progress">In Progress</option>
            <option value="resolved">Resolved</option>
          </select>

          <select id="taskProjectFilter">
            <option value="">All Projects</option>
          </select>
        </div>

        <div id="tasksList">
          <p class="loading">Loading tasks...</p>
        </div>
      </div>
    </div>

    <footer>
      <p class="footer-text">OpenProject Assistant v1.0.0</p>
    </footer>
  </div>

  <!-- Utility Scripts -->
  <script src="utils.js"></script>
  <script src="cache.js"></script>

  <!-- Main Script -->
  <script src="popup.js"></script>
</body>
</html>
